
const { ethers } = require("ethers");


const ganache = require("ganache");

const options = { logging: { quiet: true}};
const provider = new ethers.providers.Web3Provider(ganache.provider(options));


const {approveTokens, verifyApproval} = require("ethutils");

const ADJ_CONSTANT = 1000000000000000000; //10**18

const token_contract_abi = [{"inputs":[{"internalType":"address","name":"creator_","type":"address"},{"internalType":"string","name":"name_","type":"string"},{"internalType":"string","name":"symbol_","type":"string"},{"internalType":"uint256","name":"supply_","type":"uint256"},{"internalType":"uint8","name":"decimals_","type":"uint8"}],"payable":false,"stateMutability":"nonpayable","type":"constructor"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"owner","type":"address"},{"indexed":true,"internalType":"address","name":"spender","type":"address"},{"indexed":false,"internalType":"uint256","name":"value","type":"uint256"}],"name":"Approval","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"from","type":"address"},{"indexed":true,"internalType":"address","name":"to","type":"address"},{"indexed":false,"internalType":"uint256","name":"value","type":"uint256"}],"name":"Transfer","type":"event"},{"constant":true,"inputs":[{"internalType":"address","name":"owner","type":"address"},{"internalType":"address","name":"spender","type":"address"}],"name":"allowance","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"internalType":"address","name":"spender","type":"address"},{"internalType":"uint256","name":"amount","type":"uint256"}],"name":"approve","outputs":[{"internalType":"bool","name":"","type":"bool"}],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[{"internalType":"address","name":"account","type":"address"}],"name":"balanceOf","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"decimals","outputs":[{"internalType":"uint8","name":"","type":"uint8"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"internalType":"address","name":"spender","type":"address"},{"internalType":"uint256","name":"subtractedValue","type":"uint256"}],"name":"decreaseAllowance","outputs":[{"internalType":"bool","name":"","type":"bool"}],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[{"internalType":"address","name":"spender","type":"address"},{"internalType":"uint256","name":"addedValue","type":"uint256"}],"name":"increaseAllowance","outputs":[{"internalType":"bool","name":"","type":"bool"}],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":true,"inputs":[],"name":"name","outputs":[{"internalType":"string","name":"","type":"string"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"symbol","outputs":[{"internalType":"string","name":"","type":"string"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":true,"inputs":[],"name":"totalSupply","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"payable":false,"stateMutability":"view","type":"function"},{"constant":false,"inputs":[{"internalType":"address","name":"recipient","type":"address"},{"internalType":"uint256","name":"amount","type":"uint256"}],"name":"transfer","outputs":[{"internalType":"bool","name":"","type":"bool"}],"payable":false,"stateMutability":"nonpayable","type":"function"},{"constant":false,"inputs":[{"internalType":"address","name":"sender","type":"address"},{"internalType":"address","name":"recipient","type":"address"},{"internalType":"uint256","name":"amount","type":"uint256"}],"name":"transferFrom","outputs":[{"internalType":"bool","name":"","type":"bool"}],"payable":false,"stateMutability":"nonpayable","type":"function"}];
const token_contract_bytecode = '0x60806040523480156200001157600080fd5b5060405162000d7538038062000d75833981810160405260a08110156200003757600080fd5b8151602083018051604051929492938301929190846401000000008211156200005f57600080fd5b9083019060208201858111156200007557600080fd5b82516401000000008111828201881017156200009057600080fd5b82525081516020918201929091019080838360005b83811015620000bf578181015183820152602001620000a5565b50505050905090810190601f168015620000ed5780820380516001836020036101000a031916815260200191505b50604052602001805160405193929190846401000000008211156200011157600080fd5b9083019060208201858111156200012757600080fd5b82516401000000008111828201881017156200014257600080fd5b82525081516020918201929091019080838360005b838110156200017157818101518382015260200162000157565b50505050905090810190601f1680156200019f5780820380516001836020036101000a031916815260200191505b506040908152602082810151929091015186519294509250620001c89160039187019062000376565b508251620001de90600490602086019062000376565b50620001f485836001600160e01b036200021316565b6005805460ff191660ff92909216919091179055506200041b92505050565b6001600160a01b0382166200026f576040805162461bcd60e51b815260206004820152601f60248201527f45524332303a206d696e7420746f20746865207a65726f206164647265737300604482015290519081900360640190fd5b6200028b816002546200031460201b6200089a1790919060201c565b6002556001600160a01b03821660009081526020818152604090912054620002be9183906200089a62000314821b17901c565b6001600160a01b0383166000818152602081815260408083209490945583518581529351929391927fddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef9281900390910190a35050565b6000828201838110156200036f576040805162461bcd60e51b815260206004820152601660248201527f536166654d6174683a20616464206f766572666c6f7700000000000000000000604482015290519081900360640190fd5b9392505050565b828054600181600116156101000203166002900490600052602060002090601f016020900481019282601f10620003b957805160ff1916838001178555620003e9565b82800160010185558215620003e9579182015b82811115620003e9578251825591602001919060010190620003cc565b50620003f7929150620003fb565b5090565b6200041891905b80821115620003f7576000815560010162000402565b90565b61094a806200042b6000396000f3fe608060405234801561001057600080fd5b50600436106100a95760003560e01c8063395093511161007157806339509351146101d957806370a082311461020557806395d89b411461022b578063a457c2d714610233578063a9059cbb1461025f578063dd62ed3e1461028b576100a9565b806306fdde03146100ae578063095ea7b31461012b57806318160ddd1461016b57806323b872dd14610185578063313ce567146101bb575b600080fd5b6100b66102b9565b6040805160208082528351818301528351919283929083019185019080838360005b838110156100f05781810151838201526020016100d8565b50505050905090810190601f16801561011d5780820380516001836020036101000a031916815260200191505b509250505060405180910390f35b6101576004803603604081101561014157600080fd5b506001600160a01b03813516906020013561034f565b604080519115158252519081900360200190f35b610173610365565b60408051918252519081900360200190f35b6101576004803603606081101561019b57600080fd5b506001600160a01b0381358116916020810135909116906040013561036b565b6101c36103da565b6040805160ff9092168252519081900360200190f35b610157600480360360408110156101ef57600080fd5b506001600160a01b0381351690602001356103e3565b6101736004803603602081101561021b57600080fd5b50356001600160a01b031661041f565b6100b661043a565b6101576004803603604081101561024957600080fd5b506001600160a01b03813516906020013561049b565b6101576004803603604081101561027557600080fd5b506001600160a01b03813516906020013561050e565b610173600480360360408110156102a157600080fd5b506001600160a01b038135811691602001351661051b565b60038054604080516020601f60026000196101006001881615020190951694909404938401819004810282018101909252828152606093909290918301828280156103455780601f1061031a57610100808354040283529160200191610345565b820191906000526020600020905b81548152906001019060200180831161032857829003601f168201915b5050505050905090565b600061035c338484610546565b50600192915050565b60025490565b600061037884848461065e565b6103d084336103cb856040518060600160405280602181526020016108f5602191396001600160a01b038a166000908152600160209081526040808320338452909152902054919063ffffffff61080316565b610546565b5060019392505050565b60055460ff1690565b3360008181526001602090815260408083206001600160a01b0387168452909152812054909161035c9185906103cb908663ffffffff61089a16565b6001600160a01b031660009081526020819052604090205490565b60048054604080516020601f60026000196101006001881615020190951694909404938401819004810282018101909252828152606093909290918301828280156103455780601f1061031a57610100808354040283529160200191610345565b604080518082018252601e81527f64656372656173656420616c6c6f77616e63652062656c6f77207a65726f0000602080830191909152336000818152600183528481206001600160a01b038816825290925292812054909261035c92909186916103cb9190879063ffffffff61080316565b600061035c33848461065e565b6001600160a01b03918216600090815260016020908152604080832093909416825291909152205490565b6001600160a01b0383166105a1576040805162461bcd60e51b815260206004820152601d60248201527f617070726f76652066726f6d20746865207a65726f2061646472657373000000604482015290519081900360640190fd5b6001600160a01b0382166105fc576040805162461bcd60e51b815260206004820152601b60248201527f617070726f766520746f20746865207a65726f20616464726573730000000000604482015290519081900360640190fd5b6001600160a01b03808416600081815260016020908152604080832094871680845294825291829020859055815185815291517f8c5be1e5ebec7d5bd14f71427d1e84f3dd0314c0f7b2291e5b200ac8c7c3b9259281900390910190a3505050565b6001600160a01b0383166106b9576040805162461bcd60e51b815260206004820152601e60248201527f7472616e736665722066726f6d20746865207a65726f20616464726573730000604482015290519081900360640190fd5b6001600160a01b038216610714576040805162461bcd60e51b815260206004820152601c60248201527f7472616e7366657220746f20746865207a65726f206164647265737300000000604482015290519081900360640190fd5b604080518082018252601f81527f7472616e7366657220616d6f756e7420657863656564732062616c616e6365006020808301919091526001600160a01b038616600090815290819052919091205461077491839063ffffffff61080316565b6001600160a01b0380851660009081526020819052604080822093909355908416815220546107a9908263ffffffff61089a16565b6001600160a01b038084166000818152602081815260409182902094909455805185815290519193928716927fddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef92918290030190a3505050565b600081848411156108925760405162461bcd60e51b81526004018080602001828103825283818151815260200191508051906020019080838360005b8381101561085757818101518382015260200161083f565b50505050905090810190601f1680156108845780820380516001836020036101000a031916815260200191505b509250505060405180910390fd5b505050900390565b6000828201838110156108ed576040805162461bcd60e51b8152602060048201526016602482015275536166654d6174683a20616464206f766572666c6f7760501b604482015290519081900360640190fd5b939250505056fe7472616e7366657220616d6f756e74206578636565647320616c6c6f77616e6365a265627a7a723158201428d0106a45e337c6a9d34cb576b1a49835a3cc471534430768b735fd33d4cf64736f6c63430005110032';

  		
const staking_contract_abi = [{"inputs":[],"stateMutability":"nonpayable","type":"constructor"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"previousOwner","type":"address"},{"indexed":true,"internalType":"address","name":"newOwner","type":"address"}],"name":"OwnershipTransferred","type":"event"},{"inputs":[],"name":"CANNOT_TRANSFER_TO_ZERO_ADDRESS","outputs":[{"internalType":"string","name":"","type":"string"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"NOT_CURRENT_OWNER","outputs":[{"internalType":"string","name":"","type":"string"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"apy","type":"uint256"},{"internalType":"uint256","name":"minLockTime","type":"uint256"},{"internalType":"bool","name":"canJoin","type":"bool"},{"internalType":"uint256","name":"dpEndDate","type":"uint256"}],"name":"addDepositProfile","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"userWallet","type":"address"},{"internalType":"uint256","name":"depositIndex","type":"uint256"}],"name":"amountForUserDeposit","outputs":[{"internalType":"uint256","name":"depositProfileId","type":"uint256"},{"internalType":"uint256","name":"depositAmount","type":"uint256"},{"internalType":"uint256","name":"depositExtractableAmount","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"","type":"uint256"}],"name":"customersDeposits","outputs":[{"internalType":"address","name":"customer","type":"address"},{"internalType":"uint256","name":"depositsNumber","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"customersDepositsLength","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"amount","type":"uint256"},{"internalType":"uint32","name":"profileId","type":"uint32"}],"name":"deposit","outputs":[],"stateMutability":"payable","type":"function"},{"inputs":[{"internalType":"address","name":"userWallet","type":"address"},{"internalType":"uint32","name":"depositId","type":"uint32"}],"name":"depositDays","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"index","type":"uint256"},{"internalType":"uint256","name":"depositId","type":"uint256"}],"name":"depositIsExtractable","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"","type":"uint256"}],"name":"depositProfiles","outputs":[{"internalType":"uint32","name":"id","type":"uint32"},{"internalType":"uint256","name":"apy","type":"uint256"},{"internalType":"uint256","name":"minLockTime","type":"uint256"},{"internalType":"bool","name":"canJoin","type":"bool"},{"internalType":"uint256","name":"endDate","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"depositProfilesLength","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"index","type":"uint256"},{"internalType":"uint256","name":"depositId","type":"uint256"}],"name":"depositReward","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"getBaseToken","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"getContractDay","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"index","type":"uint256"}],"name":"getCustomersDepositsItem","outputs":[{"internalType":"address","name":"","type":"address"},{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint32","name":"id","type":"uint32"}],"name":"getDepositProfileById","outputs":[{"internalType":"uint256","name":"apy","type":"uint256"},{"internalType":"uint256","name":"minLockTime","type":"uint256"},{"internalType":"bool","name":"canJoin","type":"bool"},{"internalType":"uint256","name":"dpEndDate","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"getEndDate","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"getManager","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"isActive","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"userWallet","type":"address"}],"name":"numberOfUserDeposits","outputs":[{"internalType":"uint256","name":"userDepositsNumber","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"ownAddress","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"owner","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"tokenAddress","type":"address"},{"internalType":"uint256","name":"realAmountTokens","type":"uint256"}],"name":"ownerWithdrawTokens","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[],"name":"pauseContract","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"uint32","name":"id","type":"uint32"}],"name":"removeDepositProfileAtId","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"uint32","name":"index","type":"uint32"}],"name":"removeDepositProfileAtIndex","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"uint32","name":"id","type":"uint32"},{"internalType":"uint256","name":"apy","type":"uint256"},{"internalType":"uint256","name":"minLockTime","type":"uint256"},{"internalType":"bool","name":"canJoin","type":"bool"},{"internalType":"uint256","name":"dpEndDate","type":"uint256"}],"name":"replaceDepositProfileAtId","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"userWallet","type":"address"},{"internalType":"uint256","name":"depositIndex","type":"uint256"}],"name":"rewardForUserDeposit","outputs":[{"internalType":"uint256","name":"depositProfileId","type":"uint256"},{"internalType":"uint256","name":"rewardForDeposit","type":"uint256"},{"internalType":"uint256","name":"extractableRewardForDeposit","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"newBaseTokenAddress","type":"address"}],"name":"setBaseToken","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"uint256","name":"period","type":"uint256"}],"name":"setContractDay","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"uint256","name":"newEndDate","type":"uint256"}],"name":"setEndDate","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"newstakingManager","type":"address"}],"name":"setManagerRight","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[],"name":"startContract","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"_newOwner","type":"address"}],"name":"transferOwnership","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"userWallet","type":"address"},{"internalType":"uint32","name":"depositId","type":"uint32"}],"name":"viewCustomerDeposit","outputs":[{"internalType":"uint32","name":"depositProfileId","type":"uint32"},{"internalType":"uint256","name":"index","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"index","type":"uint256"},{"internalType":"uint256","name":"depositId","type":"uint256"}],"name":"viewCustomerDepositByIndex","outputs":[{"internalType":"uint32","name":"depositProfileId","type":"uint32"},{"internalType":"uint256","name":"depositAmount","type":"uint256"},{"internalType":"uint256","name":"depositDate","type":"uint256"},{"internalType":"uint256","name":"accumulatedReward","type":"uint256"},{"internalType":"bool","name":"implyLock","type":"bool"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint32","name":"depositId","type":"uint32"},{"internalType":"uint256","name":"withdrawAmount","type":"uint256"},{"internalType":"bool","name":"whole","type":"bool"}],"name":"withdrawDepositById","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"uint32","name":"depositId","type":"uint32"}],"name":"withdrawDepositRewardById","outputs":[],"stateMutability":"nonpayable","type":"function"},{"stateMutability":"payable","type":"receive"}];
const staking_contract_bytecode = '0x608060405261012c60035560006006819055600855600980546001600160a01b031916905563039ada004201600a5534801561003a57600080fd5b50600080546001600160a01b0319908116331780835560018054831630178155600255600980549092166001600160a01b039091161790556128af90819061008290396000f3fe6080604052600436106102295760003560e01c8063860d248a11610123578063d6c00f0d116100ab578063f23c64f81161006f578063f23c64f814610934578063f2fde38b1461097e578063f3fe3bc3146109b1578063fa6b674e146109c6578063feb077bb146109f657610267565b8063d6c00f0d1461084e578063d81cc37614610878578063e7d900c4146108a8578063ec783cf1146108e6578063f069d721146108fb57610267565b8063b1356488116100f2578063b13564881461076d578063d35db58714610782578063d405f662146107b2578063d428d9d614610809578063d50095841461083957610267565b8063860d248a1461067a5780638a020c38146107045780638da5cb5b1461074357806398acd7a61461075857610267565b80633f8ac26a116101b157806368894acf1161017557806368894acf146105505780636902fc061461057a578063696e3f411461058f5780636e89bf56146105f3578063701456bc1461064957610267565b80633f8ac26a1461047f5780633fcdfcf1146104a6578063439766ce146104f3578063452de525146105085780635fb02f4d1461053b57610267565b806324461c61116101f857806324461c61146103315780632576d9131461038f5780632b2dfd2c146103ee578063335339ca146104175780633784f0001461045557610267565b806301d11bf41461026c5780630ff7b8a4146102a557806316bb6c13146102d557806322f3e2d41461030857610267565b36610267573415610265576040805162461bcd60e51b81526020600482015260016024820152600760fb1b604482015290519081900360640190fd5b005b600080fd5b34801561027857600080fd5b506102656004803603604081101561028f57600080fd5b506001600160a01b038135169060200135610a29565b3480156102b157600080fd5b50610265600480360360208110156102c857600080fd5b503563ffffffff16610bda565b3480156102e157600080fd5b50610265600480360360208110156102f857600080fd5b50356001600160a01b0316610f01565b34801561031457600080fd5b5061031d610f2b565b604080519115158252519081900360200190f35b34801561033d57600080fd5b5061035b6004803603602081101561035457600080fd5b5035610f34565b6040805163ffffffff9096168652602086019490945284840192909252151560608401526080830152519081900360a00190f35b34801561039b57600080fd5b506103ce600480360360408110156103b257600080fd5b5080356001600160a01b0316906020013563ffffffff16610f6d565b6040805163ffffffff909316835260208301919091528051918290030190f35b6102656004803603604081101561040457600080fd5b508035906020013563ffffffff16610fe8565b34801561042357600080fd5b506102656004803603608081101561043a57600080fd5b5080359060208101359060408101351515906060013561127e565b34801561046157600080fd5b506102656004803603602081101561047857600080fd5b50356113bc565b34801561048b57600080fd5b506104946113c9565b60408051918252519081900360200190f35b3480156104b257600080fd5b506104d0600480360360208110156104c957600080fd5b50356113cf565b604080516001600160a01b03909316835260208301919091528051918290030190f35b3480156104ff57600080fd5b50610265611400565b34801561051457600080fd5b506102656004803603602081101561052b57600080fd5b50356001600160a01b0316611414565b34801561054757600080fd5b5061026561143e565b34801561055c57600080fd5b506102656004803603602081101561057357600080fd5b5035611455565b34801561058657600080fd5b50610494611462565b34801561059b57600080fd5b506105bf600480360360408110156105b257600080fd5b5080359060200135611468565b6040805163ffffffff9096168652602086019490945284840192909252606084015215156080830152519081900360a00190f35b3480156105ff57600080fd5b506106236004803603602081101561061657600080fd5b503563ffffffff166114b3565b604080519485526020850193909352901515838301526060830152519081900360800190f35b34801561065557600080fd5b5061065e611561565b604080516001600160a01b039092168252519081900360200190f35b34801561068657600080fd5b5061068f611570565b6040805160208082528351818301528351919283929083019185019080838360005b838110156106c95781810151838201526020016106b1565b50505050905090810190601f1680156106f65780820380516001836020036101000a031916815260200191505b509250505060405180910390f35b34801561071057600080fd5b506104946004803603604081101561072757600080fd5b5080356001600160a01b0316906020013563ffffffff16611592565b34801561074f57600080fd5b5061065e611626565b34801561076457600080fd5b5061065e611635565b34801561077957600080fd5b50610494611644565b34801561078e57600080fd5b50610265600480360360208110156107a557600080fd5b503563ffffffff1661164a565b3480156107be57600080fd5b506107eb600480360360408110156107d557600080fd5b506001600160a01b03813516906020013561170a565b60408051938452602084019290925282820152519081900360600190f35b34801561081557600080fd5b506104946004803603604081101561082c57600080fd5b5080359060200135611806565b34801561084557600080fd5b5061065e61185c565b34801561085a57600080fd5b506104d06004803603602081101561087157600080fd5b503561186b565b34801561088457600080fd5b5061031d6004803603604081101561089b57600080fd5b5080359060200135611890565b3480156108b457600080fd5b50610265600480360360608110156108cb57600080fd5b5063ffffffff8135169060208101359060400135151561192f565b3480156108f257600080fd5b50610494611d93565b34801561090757600080fd5b506107eb6004803603604081101561091e57600080fd5b506001600160a01b038135169060200135611d99565b34801561094057600080fd5b50610265600480360360a081101561095757600080fd5b5063ffffffff81351690602081013590604081013590606081013515159060800135611e62565b34801561098a57600080fd5b50610265600480360360208110156109a157600080fd5b50356001600160a01b0316611ff1565b3480156109bd57600080fd5b5061068f612104565b3480156109d257600080fd5b50610265600480360360208110156109e957600080fd5b503563ffffffff16612126565b348015610a0257600080fd5b5061049460048036036020811015610a1957600080fd5b50356001600160a01b031661220a565b610a31612255565b600154604080516370a0823160e01b81526001600160a01b03928316600482015290518492600092908416916370a0823191602480820192602092909190829003018186803b158015610a8357600080fd5b505afa158015610a97573d6000803e3d6000fd5b505050506040513d6020811015610aad57600080fd5b5051905082610aba578092505b82811015610af3576040805162461bcd60e51b81526020600482015260016024820152603360f81b604482015290519081900360640190fd5b6040805163a9059cbb60e01b81523360048201526024810185905290516001600160a01b0384169163a9059cbb9160448083019260209291908290030181600087803b158015610b4257600080fd5b505af1925050508015610b6757506040513d6020811015610b6257600080fd5b505160015b610b9c576040805162461bcd60e51b81526020600482015260016024820152603360f81b604482015290519081900360640190fd5b80610bd2576040805162461bcd60e51b81526020600482015260016024820152603360f81b604482015290519081900360640190fd5b505b50505050565b6002805460010190819055600b5460ff16610c21576040805162461bcd60e51b8152602060048201526002602482015261353160f01b604482015290519081900360640190fd5b33600080610c2f8382610f6d565b915091508163ffffffff1660001415610c74576040805162461bcd60e51b8152602060048201526002602482015261031360f41b604482015290519081900360640190fd5b610c84818663ffffffff16611890565b610cba576040805162461bcd60e51b8152602060048201526002602482015261189960f11b604482015290519081900360640190fd5b6000610ccc828763ffffffff16611806565b905080610cdc5750505050610ec2565b60048054600154604080516370a0823160e01b81526001600160a01b03928316948101949094525191169160009183916370a08231916024808301926020929190829003018186803b158015610d3157600080fd5b505afa158015610d45573d6000803e3d6000fd5b505050506040513d6020811015610d5b57600080fd5b5051905082811015610d99576040805162461bcd60e51b8152602060048201526002602482015261313360f01b604482015290519081900360640190fd5b816001600160a01b031663a9059cbb87856040518363ffffffff1660e01b815260040180836001600160a01b0316815260200182815260200192505050602060405180830381600087803b158015610df057600080fd5b505af1925050508015610e1557506040513d6020811015610e1057600080fd5b505160015b610e4a576040805162461bcd60e51b81526020600482015260016024820152603360f81b604482015290519081900360640190fd5b80610e80576040805162461bcd60e51b81526020600482015260016024820152603360f81b604482015290519081900360640190fd5b50505060009182525060076020908152604080832063ffffffff8816845260010190915281204260028201556003810191909155600401805460ff1916905550505b6002548114610efd576040805162461bcd60e51b8152602060048201526002602482015261726760f01b604482015290519081900360640190fd5b5050565b610f096122b0565b600480546001600160a01b0319166001600160a01b0392909216919091179055565b600b5460ff1690565b6005602052600090815260409020805460018201546002830154600384015460049094015463ffffffff909316939192909160ff169085565b60008060005b600854811015610fd8576000818152600760205260409020546001600160a01b0386811691161415610fd057600081815260076020908152604080832063ffffffff80891685526001909101909252909120541692509050610fe1565b600101610f73565b50600080915091505b9250929050565b6002805460010190819055600b5460ff1661102f576040805162461bcd60e51b8152602060048201526002602482015261353160f01b604482015290519081900360640190fd5b60008060008061103e866114b3565b935093509350935042811180611052575080155b611088576040805162461bcd60e51b8152602060048201526002602482015261199960f11b604482015290519081900360640190fd5b8315158061109557508215155b6110ca576040805162461bcd60e51b81526020600482015260016024820152600d60fa1b604482015290519081900360640190fd5b81611100576040805162461bcd60e51b81526020600482015260016024820152603960f81b604482015290519081900360640190fd5b60048054600154604080516323b872dd60e01b815233948101949094526001600160a01b039182166024850152604484018b90525191169182916323b872dd916064808201926020929091908290030181600087803b15801561116257600080fd5b505af192505050801561118757506040513d602081101561118257600080fd5b505160015b6111bc576040805162461bcd60e51b81526020600482015260016024820152603360f81b604482015290519081900360640190fd5b806111f2576040805162461bcd60e51b81526020600482015260016024820152603360f81b604482015290519081900360640190fd5b6111fa61280b565b6040518060a001604052808a63ffffffff1681526020018b8152602001428152602001600081526020016001151581525090506112373382612327565b505050505050506002548114611279576040805162461bcd60e51b8152602060048201526002602482015261726760f01b604482015290519081900360640190fd5b505050565b611286612255565b801580611297575042620151800181115b6112cd576040805162461bcd60e51b8152602060048201526002602482015261333160f01b604482015290519081900360640190fd5b600a5415806112ea57506000600a541180156112ea5750600a5481105b611320576040805162461bcd60e51b8152602060048201526002602482015261333160f01b604482015290519081900360640190fd5b60065460010161132e612842565b506040805160a08101825263ffffffff9283168152602080820197885281830196875294151560608201908152608082019485526006805460009081526005909752929095209051815463ffffffff19169316929092178255945160018083019190915593516002820155915160038301805460ff1916911515919091179055516004909101558154019055565b6113c46122b0565b600a55565b60035490565b6000806113da612255565b5050600090815260076020526040902080546002909101546001600160a01b0390911691565b6114086122b0565b600b805460ff19169055565b61141c6122b0565b600980546001600160a01b0319166001600160a01b0392909216919091179055565b6114466122b0565b600b805460ff19166001179055565b61145d6122b0565b600355565b60065481565b600091825260076020908152604080842092845260019283019091529091208054918101546002820154600383015460049093015463ffffffff90941694919390929160ff90911690565b60008060008060018563ffffffff1610806114d557506006548563ffffffff16115b156114eb5750600092508291508190508061155a565b63ffffffff600019860181166000818152600560205260409020549091908116908716141561154a576000908152600560205260409020600181015460028201546003830154600490930154919650945060ff9091169250905061155a565b6000806000809450945094509450505b9193509193565b6001546001600160a01b031681565b6040518060400160405280600681526020016518189c18181960d11b81525081565b6000805b60085481101561161a576000818152600760205260409020546001600160a01b038581169116141561161257600354600082815260076020908152604080832063ffffffff80891685526001909101909252822060020154919261160892909161160291429161255e16565b906125d6565b9250611620915050565b600101611596565b50600090505b92915050565b6000546001600160a01b031681565b6004546001600160a01b031690565b600a5490565b611652612255565b60008163ffffffff1611801561167057506006548163ffffffff1611155b6116a5576040805162461bcd60e51b81526020600482015260016024820152603160f81b604482015290519081900360640190fd5b63ffffffff600019820181166000908152600560205260409020548183169116146116fb576040805162461bcd60e51b81526020600482015260016024820152601960f91b604482015290519081900360640190fd5b61170760018203612126565b50565b600080600080600061171d876000610f6d565b909250905063ffffffff821661175f576040805162461bcd60e51b8152602060048201526002602482015261353560f01b604482015290519081900360640190fd5b60008181526007602052604090206002015486106117a9576040805162461bcd60e51b81526020600482015260026024820152611a9b60f11b604482015290519081900360640190fd5b6000806117b68389611806565b90506117c28389611890565b156117cf578091506117d4565b600091505b600092835260076020908152604080852099855260019099019052969091205463ffffffff1697959650949350505050565b60008060008060006118188787611468565b509350935093509350826000141561183557935061162092505050565b826000611843868584612658565b905061184f818461270a565b9998505050505050505050565b6009546001600160a01b031690565b600760205260009081526040902080546002909101546001600160a01b039091169082565b600082815260076020908152604080832084845260010190915281206004015460ff166118bf57506001611620565b60008381526007602090815260408083208584526001019091528120546118eb9063ffffffff166114b3565b5050600086815260076020908152604080832088845260010190915290206002015490925082014210159050611925576000915050611620565b5060019392505050565b6002805460010190819055600b5460ff16611976576040805162461bcd60e51b8152602060048201526002602482015261353160f01b604482015290519081900360640190fd5b336000806119848382610f6d565b915091508163ffffffff16600014156119c9576040805162461bcd60e51b8152602060048201526002602482015261031360f41b604482015290519081900360640190fd5b6119d9818863ffffffff16611890565b611a0f576040805162461bcd60e51b8152602060048201526002602482015261189960f11b604482015290519081900360640190fd5b60008515611a445750600081815260076020908152604080832063ffffffff8b16845260019081019092529091200154611a47565b50855b600082815260076020908152604080832063ffffffff8c16845260019081019092529091200154811115611aa7576040805162461bcd60e51b8152602060048201526002602482015261313360f01b604482015290519081900360640190fd5b600082815260076020908152604080832063ffffffff808d16855260019182019093529083200154611adb91849061255e16565b60048054600154604080516370a0823160e01b81526001600160a01b039283169481019490945251939450169160009183916370a0823191602480820192602092909190829003018186803b158015611b3357600080fd5b505afa158015611b47573d6000803e3d6000fd5b505050506040513d6020811015611b5d57600080fd5b5051905083811015611b9b576040805162461bcd60e51b8152602060048201526002602482015261313360f01b604482015290519081900360640190fd5b816001600160a01b031663a9059cbb88866040518363ffffffff1660e01b815260040180836001600160a01b0316815260200182815260200192505050602060405180830381600087803b158015611bf257600080fd5b505af1925050508015611c1757506040513d6020811015611c1257600080fd5b505160015b611c4c576040805162461bcd60e51b81526020600482015260016024820152603360f81b604482015290519081900360640190fd5b80611c82576040805162461bcd60e51b81526020600482015260016024820152603360f81b604482015290519081900360640190fd5b50611c93858c63ffffffff16611806565b6007600087815260200190815260200160002060010160008d63ffffffff16815260200190815260200160002060030181905550826007600087815260200190815260200160002060010160008d63ffffffff168152602001908152602001600020600101819055506000600190508360001415611d0f575060005b600095865260076020908152604080882063ffffffff8f168952600101909152909520426002808301919091556004909101805460ff1916961515969096179095555050915485149350610bd492505050576040805162461bcd60e51b8152602060048201526002602482015261726760f01b604482015290519081900360640190fd5b60085481565b6000806000806000611dac876000610f6d565b909250905063ffffffff8216611dee576040805162461bcd60e51b8152602060048201526002602482015261353560f01b604482015290519081900360640190fd5b6000818152600760205260409020600201548610611e38576040805162461bcd60e51b81526020600482015260026024820152611a9b60f11b604482015290519081900360640190fd5b60008181526007602090815260408083208984526001908101909252822001546117c28389611890565b611e6a612255565b60008563ffffffff16118015611e8857506006548563ffffffff1611155b611ebd576040805162461bcd60e51b81526020600482015260016024820152603160f81b604482015290519081900360640190fd5b63ffffffff60001986018116600090815260056020526040902054818716911614611f13576040805162461bcd60e51b81526020600482015260016024820152601960f91b604482015290519081900360640190fd5b801580611f24575042620151800181115b611f5a576040805162461bcd60e51b8152602060048201526002602482015261333160f01b604482015290519081900360640190fd5b600a541580611f7757506000600a54118015611f775750600a5481105b611fad576040805162461bcd60e51b8152602060048201526002602482015261333160f01b604482015290519081900360640190fd5b6000199490940163ffffffff1660009081526005602052604090206001810193909355600283019190915560038201805460ff191691151591909117905560040155565b611ff96122b0565b60408051808201909152600681526518189c18181960d11b60208201526001600160a01b0382166120a85760405162461bcd60e51b81526004018080602001828103825283818151815260200191508051906020019080838360005b8381101561206d578181015183820152602001612055565b50505050905090810190601f16801561209a5780820380516001836020036101000a031916815260200191505b509250505060405180910390fd5b50600080546040516001600160a01b03808516939216917f8be0079c531659141344cd1fd0a4f28419497f9722a3daafe3b4186f6b6457e091a3600080546001600160a01b0319166001600160a01b0392909216919091179055565b6040518060400160405280600681526020016530313830303160d01b81525081565b61212e612255565b6006548163ffffffff161061214257611707565b6001600654038163ffffffff1614156121645760068054600019019055611707565b63ffffffff81165b6001600654038110156121fc57600181810160008181526005602052604080822094825290208354815463ffffffff91821663ffffffff1991821617808455868601549584019590955560028087015490840155600380870154908401805460ff191660ff909216151591909117905560049586015495830195909555929093169181169190911790915561216c565b506006805460001901905550565b600080600061221a846000610f6d565b909250905063ffffffff821661223557600092505050612250565b60009081526007602052604090206002015491506122509050565b919050565b6009546001600160a01b031633148061227857506000546001600160a01b031633145b6122ae576040805162461bcd60e51b81526020600482015260026024820152610c8d60f21b604482015290519081900360640190fd5b565b60005460408051808201909152600681526530313830303160d01b6020820152906001600160a01b031633146117075760405162461bcd60e51b815260206004820181815283516024840152835190928392604490910191908501908083836000831561206d578181015183820152602001612055565b600080612335846000610f6d565b915091508163ffffffff166000146124a8576000818152600760205260408120600201549080805b838163ffffffff1610156123b2578651600086815260076020908152604080832063ffffffff86811685526001909101909252909120548116911614156123aa57600192508091506123b2565b60010161235d565b5081156124285760006123cb858363ffffffff16611806565b600086815260076020908152604080832063ffffffff8716845260019081018352922060038101939093558901519082018054909101905542600282015560808801516004909101805460ff1916911515919091179055506124a0565b60008481526007602090815260408083206002808201805460019081019091558886529182018452938290208a51815463ffffffff191663ffffffff909116178155928a015190830155880151918101919091556060870151600382015560808701516004909101805460ff19169115159190911790555b505050610bd4565b50506040805180820182526001600160a01b0393841681526001602080830182815260088054600090815260078452868120955186546001600160a01b031916991698909817855590516002948501558054875284872087805283018252958490208551815463ffffffff191663ffffffff90911617815590850151818301559284015191830191909155606083015160038301556080909201516004909101805460ff19169115159190911790558154019055565b6000828211156040518060400160405280600681526020016518181c18181960d11b815250906125cf5760405162461bcd60e51b815260206004820181815283516024840152835190928392604490910191908501908083836000831561206d578181015183820152602001612055565b5050900390565b60008082116040518060400160405280600681526020016530303830303360d01b815250906126465760405162461bcd60e51b815260206004820181815283516024840152835190928392604490910191908501908083836000831561206d578181015183820152602001612055565b5081838161265057fe5b049392505050565b600a54600090429061266957612678565b600a544211156126785750600a545b600080612684876114b3565b9350505091508060001415612698576126a4565b808311156126a4578092505b6000868411156126c2576003546126bf90611602868a61255e565b90505b60006126ce8488612781565b90506126dd81620186a06125d6565b905060006126ed8261016d6125d6565b905060006126fb8285612781565b9b9a5050505050505050505050565b60408051808201909152600681526530303830303160d01b6020820152828201908382101561277a5760405162461bcd60e51b815260206004820181815283516024840152835190928392604490910191908501908083836000831561206d578181015183820152602001612055565b5092915050565b60008261279057506000611620565b508181028183828161279e57fe5b04146040518060400160405280600681526020016530303830303160d01b8152509061277a5760405162461bcd60e51b815260206004820181815283516024840152835190928392604490910191908501908083836000831561206d578181015183820152602001612055565b6040518060a00160405280600063ffffffff1681526020016000815260200160008152602001600081526020016000151581525090565b6040518060a00160405280600063ffffffff168152602001600081526020016000815260200160001515815260200160008152509056fea2646970667358221220d3088973ac6311b8e089a2f9f6972d8abbfda471fcdd5597598c8e8d6731d19d64736f6c634300060c0033';


let token_contract, staking_contract;



testall();



let sleep = ms => new Promise(resolve => setTimeout(resolve, ms));



async function printUserBalance(user_name, user_wallet_addr){
	console.log(user_name, 'token: ', ethers.utils.formatEther( await token_contract.balanceOf(user_wallet_addr) )  );

}

async function verifyUserBalance(user_wallet_addr, t_contract) {
	if (ethers.utils.formatEther( await t_contract.balanceOf(user_wallet_addr) ) >= 5000 ){
		return true;
	} else {
		return false;
	}
	
}

/*
async function approveTokens(user_wallet_addr, user_wallet){
	let total_supply = await token_contract.totalSupply();

	let allow = await token_contract.allowance(user_wallet_addr,staking_contract.address);
            
	
    if (allow.toString() == total_supply.toString()) return;
      

    const user_token_rw = new ethers.Contract(token_contract.address, token_contract_abi, user_wallet);
	
	let tx = await user_token_rw.approve(staking_contract.address,total_supply.toString(), {
                              
                                              gasPrice: 10000000000,
                                              gasLimit: 3000000
                                            }); 
  	await tx.wait();


}

async function verifyApproval(t_contract, user_wallet_addr, staking_contract_addr){
	let total_supply = await t_contract.totalSupply();

	let allow = await t_contract.allowance(user_wallet_addr,staking_contract_addr);
            
	
    if (allow.toString() == total_supply.toString()){ 
    	return true;
    } else {
    	return false;
    }
     

}
*/



async function stakeTokens(num, profileId ,stake_contract){
 


    let tx = await stake_contract.deposit(ethers.BigNumber.from(num),profileId, {
                              
                                              gasPrice: 10000000000,
                                              gasLimit: 3000000
                                            }); 
    await tx.wait();
}


async function withdrawDeposit(stake_contract, depositId, withdrawAmount, whole){
	
	let tx = await stake_contract.withdrawDepositById(depositId, withdrawAmount, whole,{
                              
                                              gasPrice: 10000000000,
                                              gasLimit: 3000000
                                            }); 
	await tx.wait();
	
}


async function withdrawDepositReward(stake_contract, depositId){

	let tx = await stake_contract.withdrawDepositRewardById(depositId,{
                              
                                              gasPrice: 10000000000,
                                              gasLimit: 3000000
                                            }); 
	await tx.wait();

}

async function outputDeposits(user_wallet_addr,stake_contract){ 

     
	  let numDeposits = parseInt(await stake_contract.numberOfUserDeposits(user_wallet_addr));     
      
      for (let i = 0; i < numDeposits; i++){
      	
      	let dep = await stake_contract.amountForUserDeposit(user_wallet_addr, i);
      	let rew = await stake_contract.rewardForUserDeposit(user_wallet_addr, i);
      	
      	
      	console.log('deposit  #'+i.toString());
      	console.log('deposit profile: ' + dep.depositProfileId);;
      	console.log('deposit amount: '  + ethers.utils.formatEther(dep.depositAmount));
      	let usd_bn = ethers.BigNumber.from(dep.usdDepositAmount); 
      	usd_bn = usd_bn.mul(ethers.BigNumber.from('10000000000'));
      	console.log('USD deposit amount: '  + ethers.utils.formatEther(usd_bn));
      	console.log('extractable deposit amount: '  + ethers.utils.formatEther(dep.depositExtractableAmount));
      	console.log('deposit reward: '  + ethers.utils.formatEther(rew.rewardForDeposit));
      	usd_bn = ethers.BigNumber.from(rew.usdRewardForDeposit); 
      	usd_bn = usd_bn.mul(ethers.BigNumber.from('10000000000'));	
      	console.log('USD reward amount: '  + ethers.utils.formatEther(usd_bn));
      	console.log('extractable reward amount: '  + ethers.utils.formatEther(rew.extractableRewardForDeposit));
      	
      }

}


async function verifyDeposit(user_wallet_addr,stake_contract, amount, id){ 

     
	 
      	
      let dep = await stake_contract.amountForUserDeposit(user_wallet_addr, id);
      	
      if (ethers.utils.formatEther(dep.depositAmount) == amount){
      	return true;
      } else {
      	return false;
      }
      	
}







async function verifyWithdrawDeposits(user_wallet_addr,stake_contract){ 

     
	  let numDeposits;	
      try {
	  	numDeposits = parseInt(await stake_contract.numberOfUserDeposits(user_wallet_addr));   
	  	//console.log('numDeposits=', numDeposits); 
	  } catch {
	  	return false;
	  }

	 
      
      for (let i = 0; i < numDeposits; i++){
      	
      	
      	let dep = await stake_contract.amountForUserDeposit(user_wallet_addr, i);

      	if (dep.depositAmount.toString() == '0') continue;

      	let rew = await stake_contract.rewardForUserDeposit(user_wallet_addr, i);
      	let dep_days = await stake_contract.depositDays(user_wallet_addr, i);
      	let contract_day = await stake_contract.getContractDay(); 

      	let dep_profile = await stake_contract.getDepositProfileById(dep.depositProfileId);
     
  		let lock_time = parseInt( dep_profile.minLockTime.toString() );
  		let dep_time = parseInt( (dep_days.mul(contract_day)).toString() );

  		
  		
  		if (lock_time < dep_time){
  			
  			
  			try {
				await withdrawDeposit(stake_contract, i, 0, true);
				
			} catch {
				return false; //incorrect 
				 			
			}

			try {
				await withdrawDepositReward(stake_contract, i);
				
			} catch {
				return false; //incorrect			
			}

			

  		}	
      	
      }

      return true;

     

}

async function testall(){

	

	const accounts = await provider.listAccounts();

	console.log('test accounts');
	console.log(accounts);

	console.log('1st account is contract deployer');
	console.log('2-4 accounts are test users');


	let admin_wallet = provider.getSigner(0);
	const admin_wallet_addr = accounts[0];


	let user1_wallet = provider.getSigner(1);
	const user1_wallet_addr = accounts[1];

	let user2_wallet = provider.getSigner(2);
	const user2_wallet_addr = accounts[2];

	let user3_wallet = provider.getSigner(3)
	const user3_wallet_addr = accounts[3];

	




	
	
	console.log('/* 1.deploy token contract */');

	try {
	    let contract_factory = new ethers.ContractFactory(token_contract_abi, token_contract_bytecode, admin_wallet);
	  
	    token_contract = await contract_factory.deploy(admin_wallet_addr, 'ZZZ', 'ZZZ', '1000000000000000000000000', 18);
	  	
	  	
	    await token_contract.deployTransaction.wait(); //after that it is deployed;

	    console.log ('token address=',token_contract.address);

	}  catch (e) {

		console.log('== 1.deploy token contract - failed ==');
		process.exit(0);
	}

	 


	console.log('== 1.deploy token contract - passed ==');
  	

	
	console.log('/* 2.users get tokens from deployer */');
	
		  
	
	
	if (!await verifyUserBalance(user1_wallet_addr, token_contract)) await token_contract.connect(admin_wallet).transfer(user1_wallet_addr, '15000000000000000000000');
	if (!await verifyUserBalance(user2_wallet_addr, token_contract)) await token_contract.connect(admin_wallet).transfer(user2_wallet_addr, '15000000000000000000000');
	if (!await verifyUserBalance(user3_wallet_addr, token_contract)) await token_contract.connect(admin_wallet).transfer(user3_wallet_addr, '15000000000000000000000');
		
	console.log('user balaces:');
				

  	await printUserBalance('user1', user1_wallet_addr); 
	await printUserBalance('user2', user2_wallet_addr); 
	await printUserBalance('user3', user3_wallet_addr); 


	if ( await verifyUserBalance(user1_wallet_addr, token_contract) && 
	 	 await verifyUserBalance(user2_wallet_addr, token_contract)  &&
		 await verifyUserBalance(user3_wallet_addr, token_contract) 
		  ) {
		console.log('=== 2 - user balances- passed ===');
	} else {
		console.log('=== 2 - user balances- failed ===');
		process.exit(0);
	}
		 
	
	console.log('/* 3.deploy staking contract */');

	try {
	    let contract_factory = new ethers.ContractFactory(staking_contract_abi, staking_contract_bytecode, admin_wallet);

	    staking_contract = await contract_factory.deploy();

	    await staking_contract.deployTransaction.wait(); //after that it is deployed;

	}  catch (e) {

		console.log('== 1.deploy staking contract - failed ==');
		process.exit(0);
	}

	 

	console.log('== 3.deploy staking contract - passed ==');


	console.log('/* 4.configure staking contract */');

	try {
		await staking_contract.connect(admin_wallet).setContractDay(300); //300 seconds (5 min)
		await staking_contract.connect(admin_wallet).setBaseToken(token_contract.address); 
		await staking_contract.connect(admin_wallet).addDepositProfile(10000, 300, true, 0); 
		await staking_contract.connect(admin_wallet).addDepositProfile(15000, 450, true, 0); 
		await staking_contract.connect(admin_wallet).addDepositProfile(20000, 600, true, 0); 

		await staking_contract.connect(admin_wallet).startContract(); 


	} catch (e) {
		console.log('== 4.configure staking contract - failed ==');
		process.exit(0);	
	}
  	console.log('== 4.configure staking contract - passed ==');

 	console.log('/* 5.approve tokens move */');

  	const user1_stake_token_rw = new ethers.Contract(staking_contract.address, staking_contract_abi, user1_wallet);
	const user2_stake_token_rw = new ethers.Contract(staking_contract.address, staking_contract_abi, user2_wallet);
	const user3_stake_token_rw = new ethers.Contract(staking_contract.address, staking_contract_abi, user3_wallet);

	const admin_staking_rw = new ethers.Contract(staking_contract.address, staking_contract_abi, admin_wallet);
    
	await approveTokens(user1_wallet_addr, user1_wallet, token_contract, staking_contract.address);
	await approveTokens(user2_wallet_addr, user2_wallet, token_contract, staking_contract.address);
	await approveTokens(user3_wallet_addr, user3_wallet, token_contract, staking_contract.address);


	if ( 	await verifyApproval(token_contract, user1_wallet_addr, staking_contract.address) &&
			await verifyApproval(token_contract, user2_wallet_addr, staking_contract.address) &&
			await verifyApproval(token_contract, user3_wallet_addr, staking_contract.address) 
		 ){

		console.log('=== 5 - token approval- passed ===');
	} else {
		console.log('=== 5 - token approval- failed ===');
		process.exit(0);
	}



  	console.log('/* 6.stake tokens */');

  	await stakeTokens('5000000000000000000000',1,user1_stake_token_rw);
  	await stakeTokens('2000000000000000000000',2,user1_stake_token_rw);
  	await stakeTokens('3000000000000000000000',3,user1_stake_token_rw);

  	await stakeTokens('5000000000000000000000',1,user2_stake_token_rw);
  	await stakeTokens('2000000000000000000000',2,user2_stake_token_rw);
  	await stakeTokens('3000000000000000000000',3,user2_stake_token_rw);

  	await stakeTokens('5000000000000000000000',1,user3_stake_token_rw);
  	await stakeTokens('2000000000000000000000',2,user3_stake_token_rw);
  	await stakeTokens('3000000000000000000000',3,user3_stake_token_rw);
 
 	
 	console.log('wait 3 seconds');	
 	sleep(300);

 	if (	await verifyDeposit(user1_wallet_addr, user1_stake_token_rw,5000, 0) && 
 			await verifyDeposit(user1_wallet_addr, user1_stake_token_rw,2000, 1) &&
 			await verifyDeposit(user1_wallet_addr, user1_stake_token_rw,3000, 2)){
 		console.log('=== 6 - user1 stake tokens- passed ===');
 	} else {
 		console.log('=== 6 - user1 stake tokens- failed ===');
 		process.exit(0);
 	}


 	if (	await verifyDeposit(user2_wallet_addr, user2_stake_token_rw,5000, 0) && 
 			await verifyDeposit(user2_wallet_addr, user2_stake_token_rw,2000, 1) &&
 			await verifyDeposit(user2_wallet_addr, user2_stake_token_rw,3000, 2)){
 		console.log('=== 6 - user2 stake tokens- passed ===');
 	} else {
 		console.log('=== 6 - user2 stake tokens- failed ===');
 		process.exit(0);
 	}


 	if (	await verifyDeposit(user3_wallet_addr, user3_stake_token_rw,5000, 0) && 
 			await verifyDeposit(user3_wallet_addr, user3_stake_token_rw,2000, 1) &&
 			await verifyDeposit(user3_wallet_addr, user3_stake_token_rw,3000, 2)){
 		console.log('=== 6 - user3 stake tokens- passed ===');
 	} else {
 		console.log('=== 6 - user1 stake tokens- failed ===');
 		process.exit(0);
 	}

 	
 	
 	
  
  	console.log('/* 7.verify withdraw deposits */');

  	if ( await verifyWithdrawDeposits(user1_wallet_addr, user1_stake_token_rw) ) {
  		console.log('=== 7- user1 verify withdraw deposits - passed ===');	
  	} else {
 		console.log('=== 7- user1 verify withdraw deposits - failed ===');	
 		process.exit(0);
 	}
 	

 	
  	if ( await verifyWithdrawDeposits(user2_wallet_addr, user2_stake_token_rw) ) {
  		console.log('=== 7- user2 verify withdraw deposits - passed ===');	
  	} else {
 		console.log('=== 7- user2 verify withdraw deposits - failed ===');	
 		process.exit(0);
 	}
 	
 	
 	
  	if ( await verifyWithdrawDeposits(user3_wallet_addr, user3_stake_token_rw) ) {
  		console.log('=== 7- user3 verify withdraw deposits - passed ===');	
  	} else {
 		console.log('=== 7- user3 verify withdraw deposits - failed ===');	
 		process.exit(0);
 	}
 	
 
 	console.log('=== all tests passed ===');	
}


